{% extends "base.html" %}
{% block info %}
<!-- Adding a Trip Section -->
<div class="container">
    <div class="col-md-12">
    </div>
</div>

{% endblock %}
{% block content %}

<div class="page-header">
  <h1> {{object.user.username}}: Reimbursements</h1>
          <h4> Current Pay Period: <small>{{ current.due }}</small></h4>
        <h4> Department: <small>{{ user.groups.all.0 }}</small></h4>
</div>

<form action="." method="post">
    {{ formset.management_form }}
    {% csrf_token %}
    <div class="emptystaff">
        {{ form }}
    </div>
    <legend>Paid Reimbursements</legend>

    <div class="tripset col-md-12">
    {% regroup formset by instance.created.date as form_list %}
    {% for form in form_list %}
        <div class="panel panel-default">
            <div class="panel-heading">
                <h1 class="panel-title">{{ form.grouper }}</h1>
            </div>
            <ul class="list group" style="padding:0px;margin:0px">
            <button onclick="myFunction()">Approve All</button>
                {{ kwargs.paid }}


                {% for form in form.list %}
                <li class="clearfix list-group-item">
                    <div class="col-md-9">
                        {% for hidden in form.hidden_fields %}
                            {{ hidden }}
                        {% endfor %}
                        <div class="hidden">{{ form.trip_begin }}</div>
                        <div class="hidden">{{ form.trip_end }}</div>
                        <div class="hidden">{{ form.DELETE }}</div>
                        <div class="hidden">{{ form.created }}</div>
                        <div class="hidden">{{ form.description }}</div>
                        <div class="hidden">{{ form.distance }}</div>
                        <div class="hidden">{{ form.amount_owed }}</div>
                        <div class="row">
                            <b>{{ form.instance.distance }}kms</b> and <b> ${{form.instance.amount_owed }}</b>
                        </div>
                        {{ form.instance.description }}
                    </div>
                        <div class="col-md-3">
                        {% if supervisor in user.groups.all %}
                            approved?: {{ form.approved }}
                        {% else %}
                            <div class="hidden"> {{form.approved}}</div>
                            approved?: {{form.instance.approved}}
                        {% endif %}

                        {% if admin in user.groups.all %}
                            paid?: {{ form.paid }}
                        {% else %}
                            <div class="hidden"> {{ form.paid }}</div>
                            paid?: {{ form.instance.approved }}
                        {% endif %}
                    </div>

                </li>
                {% endfor %}
            </ul>

        </div>
    {% endfor %}
        <div class="pull-right">
            <button type="submit" class="btn btn-primary">Save</button>
        </div>
    </div>
</form>

    <legend>Approved Reimbursements For this Pay Period<small> Total Distance: Total Reimbursement: </small></legend>
    <div class="tripset col-md-12">
            {% for trip in approved_trips %}
                <div class="row">
                    <div class="col-md-9">
                        {{ trip.created }}
                        {{ trip.description }}
                        {{ trip.distance }}
                        {{ trip.amount_owed }}
                    </div>
                </div>
            {% endfor %}
    </div>
<script>
<script>
function myFunction() {
    for form in form.list
        form.paid = true;
        form.save();
}
</script>
{% endblock %}